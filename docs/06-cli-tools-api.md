# CLI-инструменты через API (Claude Code CLI и Codex CLI)

> ⚠️ **Важно:** Эта инструкция описывает установку инструментов командной строки, которые **требуют API-доступ и оплаты отдельно от подписки**. Если у вас есть подписка Claude Pro или ChatGPT Plus, используйте десктопные приложения или расширения VS Code.

## Введение

### Разница между подпиской и API-доступом

Важно понимать, что это **два разных продукта** с разными системами оплаты:

| Параметр | Подписка (Claude Pro/ChatGPT Plus) | API-доступ |
|----------|-------------------------------------|------------|
| **Назначение** | Веб-интерфейс и десктопные приложения | Программный доступ (CLI, SDK, интеграции) |
| **Оплата** | Фиксированная ($20/месяц) | Pay-as-you-go (платите за каждый запрос) |
| **Включает** | Claude Desktop, расширения VS Code | Claude Code CLI, API для разработчиков |
| **Требования** | Не нужны API-ключи | Нужен API-ключ и привязка карты |

### Кому подходят CLI-инструменты?

CLI-инструменты (Claude Code CLI, Codex CLI) подходят, если вам нужно:

- Автоматизировать задачи через скрипты
- Интегрировать AI в свои приложения
- Использовать AI в CI/CD пайплайнах
- Работать с AI программно (не через GUI)

**Если вы просто хотите использовать AI для разработки:**
- Используйте **Claude Desktop** (если есть подписка Claude Pro)
- Используйте **расширение Claude for VS Code**
- Используйте **ChatGPT Desktop** или расширения для VS Code

---

## Claude Code CLI

### Что это такое

**Claude Code** — инструмент командной строки от Anthropic для работы с Claude через терминал.

**Возможности:**
- Выполнение сложных многошаговых задач
- Редактирование файлов в проектах
- Запуск команд в терминале
- Интеграция с MCP серверами

### Стоимость использования

- **API-доступ платный** (pay-as-you-go)
- Цены на январь 2025:
  - Claude 3.5 Sonnet: $3 за 1M входных токенов, $15 за 1M выходных токенов
  - Claude 3.5 Haiku: $1 за 1M входных токенов, $5 за 1M выходных токенов
- Anthropic дает **$5 бесплатных кредитов** при регистрации для тестирования

Актуальные цены: [anthropic.com/pricing](https://www.anthropic.com/pricing)

### Установка

```bash
npm install -g @anthropic-ai/claude-code
```

Проверка:
```bash
claude --version
```

### Получение API-ключа Anthropic

1. Перейдите на [platform.claude.com](https://platform.claude.com/)
2. Зарегистрируйтесь или войдите
3. Перейдите в раздел **API Keys**
4. Нажмите **Create Key**
5. Скопируйте ключ (начинается с `sk-ant-`)

⚠️ **Важно:** Ключ показывается только один раз!

### Настройка API-ключа

<details>
<summary><strong>Windows (PowerShell)</strong></summary>

Постоянно (рекомендуется):
```powershell
[Environment]::SetEnvironmentVariable("ANTHROPIC_API_KEY", "sk-ant-...", "User")
```

Временно (для текущей сессии):
```powershell
$env:ANTHROPIC_API_KEY = "sk-ant-..."
```

После установки постоянной переменной перезапустите PowerShell.

</details>

<details>
<summary><strong>macOS / Linux</strong></summary>

Добавьте в `~/.bashrc`, `~/.zshrc` или `~/.profile`:

```bash
export ANTHROPIC_API_KEY="sk-ant-..."
```

Затем перезагрузите конфигурацию:
```bash
source ~/.bashrc  # или ~/.zshrc
```

</details>

### Проверка настройки

```bash
# Windows PowerShell
echo $env:ANTHROPIC_API_KEY

# macOS / Linux
echo $ANTHROPIC_API_KEY
```

### Использование

```bash
# Запуск интерактивного режима
claude

# Выполнение задачи
claude "создай простой HTTP-сервер на Node.js"

# Работа с файлом
claude "оптимизируй код в файле app.js"
```

---

## Codex CLI (OpenAI)

### Что это такое

**Codex CLI** — инструмент командной строки от OpenAI для работы с моделями GPT через терминал.

### Стоимость использования

- **API-доступ платный** (pay-as-you-go)
- Цены на январь 2025:
  - GPT-4o: $2.50 за 1M входных токенов, $10 за 1M выходных токенов
  - GPT-4o-mini: $0.15 за 1M входных токенов, $0.60 за 1M выходных токенов
- OpenAI дает небольшие бесплатные кредиты при регистрации

Актуальные цены: [openai.com/pricing](https://openai.com/pricing)

### Установка

```bash
npm install -g @openai/codex
```

Проверка:
```bash
codex --version
```

### Получение API-ключа OpenAI

1. Перейдите на [platform.openai.com](https://platform.openai.com/)
2. Зарегистрируйтесь или войдите
3. Перейдите в **API Keys**
4. Нажмите **Create new secret key**
5. Скопируйте ключ (начинается с `sk-`)

⚠️ **Важно:** Ключ показывается только один раз!

### Настройка API-ключа

<details>
<summary><strong>Windows (PowerShell)</strong></summary>

Постоянно:
```powershell
[Environment]::SetEnvironmentVariable("OPENAI_API_KEY", "sk-...", "User")
```

Временно:
```powershell
$env:OPENAI_API_KEY = "sk-..."
```

</details>

<details>
<summary><strong>macOS / Linux</strong></summary>

Добавьте в `~/.bashrc`, `~/.zshrc` или `~/.profile`:

```bash
export OPENAI_API_KEY="sk-..."
```

Перезагрузите:
```bash
source ~/.bashrc
```

</details>

---

## Альтернативы без API-доступа

Если вы не хотите платить за API-доступ, используйте:

### 1. Десктопные приложения

- **Claude Desktop** — работает с подпиской Claude Pro
  - Скачать: [claude.ai/download](https://claude.ai/download)
  - Стоимость: $20/месяц (Claude Pro)

- **ChatGPT Desktop** — работает с подпиской ChatGPT Plus
  - Скачать: [openai.com/chatgpt/download](https://openai.com/chatgpt/download)
  - Стоимость: $20/месяц (ChatGPT Plus)

### 2. Расширения VS Code

- **Claude for VS Code**
  - Издатель: Anthropic
  - Работает с подпиской Claude Pro
  - Установка: `code --install-extension anthropic.claude-code`

- **Codex для VS Code**
  - Издатель: OpenAI
  - Работает с подпиской ChatGPT Plus или OpenAI API
  - Установка: `code --install-extension openai.codex`

---

## Сравнение: CLI vs Desktop vs VS Code

| Критерий | CLI (API) | Desktop приложение | Расширение VS Code |
|----------|-----------|--------------------|--------------------|
| **Оплата** | Pay-as-you-go | Фиксированная подписка | Фиксированная подписка |
| **Работа в терминале** | ✅ Да | ❌ Нет | ❌ Нет |
| **Автоматизация** | ✅ Да | ❌ Нет | ⚠️ Ограниченно |
| **Интеграция в код** | ✅ Да | ❌ Нет | ✅ Да |
| **GUI** | ❌ Нет | ✅ Да | ✅ Да |
| **Стоимость входа** | $5-10 на тест | $20/месяц | $10-20/месяц |

---

## Безопасность API-ключей

### ❌ Никогда не делайте

- Не коммитьте ключи в Git
- Не публикуйте ключи в открытых репозиториях
- Не делитесь ключами с другими
- Не храните ключи в коде

### ✅ Рекомендуется

- Храните ключи в переменных окружения
- Используйте `.env` файлы (добавленные в `.gitignore`)
- Регулярно ротируйте ключи
- Используйте разные ключи для разных проектов
- Мониторьте использование API в консолях

### Если ключ утёк

1. **Немедленно** удалите ключ в консоли:
   - Anthropic: [platform.claude.com/settings/keys](https://platform.claude.com/settings/keys)
   - OpenAI: [platform.openai.com/api-keys](https://platform.openai.com/api-keys)

2. Создайте новый ключ

3. Обновите переменные окружения

4. Проверьте историю использования на предмет подозрительной активности

---

## Мониторинг затрат

### Anthropic Console

1. Откройте [platform.claude.com](https://platform.claude.com/)
2. Перейдите в **Usage**
3. Посмотрите статистику использования и затраты

### OpenAI Platform

1. Откройте [platform.openai.com/usage](https://platform.openai.com/usage)
2. Просмотрите детальную статистику использования

### Установка лимитов

**Anthropic:**
- Settings → Billing → Set usage limits

**OpenAI:**
- Settings → Billing → Usage limits

Рекомендуется установить лимиты, чтобы избежать неожиданных трат.

---

## Часто задаваемые вопросы

### У меня есть подписка Claude Pro. Нужен ли мне API-доступ?

**Нет**, если вы используете:
- Claude Desktop (десктопное приложение)
- Расширение Claude for VS Code

API-доступ нужен только для CLI-инструментов и программной интеграции.

### Можно ли использовать подписку для CLI?

**Нет**, подписка и API — это разные продукты. CLI требует API-ключ и оплату отдельно.

### Сколько стоит API на практике?

Для обычного использования (несколько запросов в день):
- Claude: $1-5 в месяц
- OpenAI: $1-10 в месяц

Для активного использования может быть выгоднее подписка на десктопное приложение.

### Есть ли бесплатные кредиты?

Да:
- **Anthropic**: $5 при регистрации
- **OpenAI**: небольшие кредиты для тестирования

### Как отследить расходы?

- Установите лимиты в настройках биллинга
- Проверяйте usage в консолях
- Настройте email-уведомления о превышении порога

---

## Заключение

CLI-инструменты — мощный способ работы с AI, но требуют API-доступа и оплаты. Для большинства пользователей **рекомендуется использовать десктопные приложения или расширения VS Code** с подпиской.

CLI подходит для:
- Автоматизации задач
- Интеграции в CI/CD
- Программной работы с AI

Если вы только начинаете, попробуйте бесплатные кредиты или используйте альтернативы с подпиской.

---

*Последнее обновление: январь 2025*
