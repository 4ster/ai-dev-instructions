# CLI-инструменты через API (Codex CLI)

> ⚠️ **Важно:** Эта инструкция описывает установку инструментов командной строки, которые **требуют API-доступ и оплаты отдельно от подписки**. Если у вас есть подписка ChatGPT Plus, используйте десктопные приложения или расширения VS Code.

## Введение

### Разница между подпиской и API-доступом

Важно понимать, что это **два разных продукта** с разными системами оплаты:

| Параметр | Подписка (ChatGPT Plus) | API-доступ |
|----------|-------------------------------------|------------|
| **Назначение** | Веб-интерфейс и десктопные приложения | Программный доступ (CLI, SDK, интеграции) |
| **Оплата** | Фиксированная ($20/месяц) | Pay-as-you-go (платите за каждый запрос) |
| **Включает** | ChatGPT Desktop, расширения VS Code | Codex CLI, API для разработчиков |
| **Требования** | Не нужны API-ключи | Нужен API-ключ и привязка карты |

### Кому подходят CLI-инструменты?

CLI-инструменты (Codex CLI) подходят, если вам нужно:

- Автоматизировать задачи через скрипты
- Интегрировать AI в свои приложения
- Использовать AI в CI/CD пайплайнах
- Работать с AI программно (не через GUI)

**Если вы просто хотите использовать AI для разработки:**
- Используйте **ChatGPT Desktop** (если есть подписка ChatGPT Plus)
- Используйте **расширение Claude for VS Code** (требует подписку Claude Pro)
- Используйте **расширения для VS Code**

---

## Codex CLI (OpenAI)

### Что это такое

**Codex CLI** — инструмент командной строки от OpenAI для работы с моделями GPT через терминал.

### Стоимость использования

- **API-доступ платный** (pay-as-you-go)
- Цены на январь 2025:
  - GPT-4o: $2.50 за 1M входных токенов, $10 за 1M выходных токенов
  - GPT-4o-mini: $0.15 за 1M входных токенов, $0.60 за 1M выходных токенов
- OpenAI дает небольшие бесплатные кредиты при регистрации

Актуальные цены: [openai.com/pricing](https://openai.com/pricing)

### Установка

```bash
npm install -g @openai/codex
```

Проверка:
```bash
codex --version
```

### Получение API-ключа OpenAI

1. Перейдите на [platform.openai.com](https://platform.openai.com/)
2. Зарегистрируйтесь или войдите
3. Перейдите в **API Keys**
4. Нажмите **Create new secret key**
5. Скопируйте ключ (начинается с `sk-`)

⚠️ **Важно:** Ключ показывается только один раз!

### Настройка API-ключа

<details>
<summary><strong>Windows (PowerShell)</strong></summary>

Постоянно:
```powershell
[Environment]::SetEnvironmentVariable("OPENAI_API_KEY", "sk-...", "User")
```

Временно:
```powershell
$env:OPENAI_API_KEY = "sk-..."
```

</details>

<details>
<summary><strong>macOS / Linux</strong></summary>

Добавьте в `~/.bashrc`, `~/.zshrc` или `~/.profile`:

```bash
export OPENAI_API_KEY="sk-..."
```

Перезагрузите:
```bash
source ~/.bashrc
```

</details>

---

## Альтернативы без API-доступа

Если вы не хотите платить за API-доступ, используйте:

### 1. Десктопные приложения

- **Claude Desktop** — работает с подпиской Claude Pro
  - Скачать: [claude.ai/download](https://claude.ai/download)
  - Стоимость: $20/месяц (Claude Pro)

- **ChatGPT Desktop** — работает с подпиской ChatGPT Plus
  - Скачать: [openai.com/chatgpt/download](https://openai.com/chatgpt/download)
  - Стоимость: $20/месяц (ChatGPT Plus)

### 2. Расширения VS Code

- **Claude for VS Code**
  - Издатель: Anthropic
  - Работает с подпиской Claude Pro
  - Установка: `code --install-extension anthropic.claude-code`

- **Codex для VS Code**
  - Издатель: OpenAI
  - Работает с подпиской ChatGPT Plus или OpenAI API
  - Установка: `code --install-extension openai.codex`

---

## Сравнение: CLI vs Desktop vs VS Code

| Критерий | CLI (API) | Desktop приложение | Расширение VS Code |
|----------|-----------|--------------------|--------------------|
| **Оплата** | Pay-as-you-go | Фиксированная подписка | Фиксированная подписка |
| **Работа в терминале** | ✅ Да | ❌ Нет | ❌ Нет |
| **Автоматизация** | ✅ Да | ❌ Нет | ⚠️ Ограниченно |
| **Интеграция в код** | ✅ Да | ❌ Нет | ✅ Да |
| **GUI** | ❌ Нет | ✅ Да | ✅ Да |
| **Стоимость входа** | $5-10 на тест | $20/месяц | $10-20/месяц |

---

## Безопасность API-ключей

### ❌ Никогда не делайте

- Не коммитьте ключи в Git
- Не публикуйте ключи в открытых репозиториях
- Не делитесь ключами с другими
- Не храните ключи в коде

### ✅ Рекомендуется

- Храните ключи в переменных окружения
- Используйте `.env` файлы (добавленные в `.gitignore`)
- Регулярно ротируйте ключи
- Используйте разные ключи для разных проектов
- Мониторьте использование API в консолях

### Если ключ утёк

1. **Немедленно** удалите ключ в консоли:
   - OpenAI: [platform.openai.com/api-keys](https://platform.openai.com/api-keys)

2. Создайте новый ключ

3. Обновите переменные окружения

4. Проверьте историю использования на предмет подозрительной активности

---

## Мониторинг затрат

### OpenAI Platform

1. Откройте [platform.openai.com/usage](https://platform.openai.com/usage)
2. Просмотрите детальную статистику использования

### Установка лимитов

**OpenAI:**
- Settings → Billing → Usage limits

Рекомендуется установить лимиты, чтобы избежать неожиданных трат.

---

## Часто задаваемые вопросы

### Можно ли использовать подписку для CLI?

**Нет**, подписка и API — это разные продукты. CLI требует API-ключ и оплату отдельно.

### Сколько стоит API на практике?

Для обычного использования (несколько запросов в день):
- OpenAI: $1-10 в месяц

Для активного использования может быть выгоднее подписка на десктопное приложение.

### Есть ли бесплатные кредиты?

Да, **OpenAI** даёт небольшие кредиты для тестирования при регистрации.

### Как отследить расходы?

- Установите лимиты в настройках биллинга
- Проверяйте usage в консолях
- Настройте email-уведомления о превышении порога

---

## Заключение

CLI-инструменты — мощный способ работы с AI, но требуют API-доступа и оплаты. Для большинства пользователей **рекомендуется использовать десктопные приложения или расширения VS Code** с подпиской.

CLI подходит для:
- Автоматизации задач
- Интеграции в CI/CD
- Программной работы с AI

Если вы только начинаете, попробуйте бесплатные кредиты или используйте альтернативы с подпиской.

---

*Последнее обновление: январь 2025*
